# Інструкція по створенню та публікації Helm чарта для KBOT

Ця інструкція допоможе вам упакувати та випустити нову версію Helm чарта для KBOT.

## Необхідні умови

- Переконайтеся, що версія в файлі `values.yaml` та шаблонах чарта оновлена відповідно до потрібної версії (в цій інструкції буде використано версію `1.0.12` як приклад).
- У вас повинен бути встановлений [Helm](https://helm.sh/docs/intro/install/).
- Також, переконайтеся що встановлений [GitHub CLI (gh)](https://cli.github.com/manual/installation).
- **GitHub Token:** Вам потрібен буде ваш особистий токен для аутентифікації через GitHub CLI для створення релізів.

---

## Кроки для створення релізу Helm чарта

### 1. Упакуйте нову версію Helm чарта

Спершу необхідно упакувати оновлену версію Helm чарта. Замість `1.0.12` замініть номер версії на той, який ви встановили в `values.yaml`. Наприклад, для випуску версії `1.0.12`, виконайте команду:

```bash
helm package ./helm --version 1.0.12
```

Це створить упакований Helm чарт з іменем `helm-1.0.12.tgz`.

> **Примітка:** Замість `1.0.12` використовуйте реальну версію, яку ви випускаєте, вона повинна відповідати версії, вказаній у вашому файлі `values.yaml`.

---

### 2. Встановіть GitHub CLI (якщо ще не встановлено)

Якщо ви ще не встановили GitHub CLI, слідуйте [офіційній інструкції по встановленню](https://cli.github.com/manual/installation).

---

### 3. Аутентифікація через GitHub CLI

Перед створенням релізу необхідно аутентифікуватися у GitHub. Для цього існує два способи:

#### Варіант 1: Вхід через GitHub CLI

Виконайте наступну команду:

```bash
gh auth login
```

Дотримуйтесь інструкцій для входу через веббраузер або за допомогою токена.

#### Варіант 2: Використання персонального GitHub токена

Ви можете задати персональний GitHub токен для аутентифікації через змінну оточення, що є особливо зручним для автоматизації процесу. Щоб це зробити, вам потрібно експортувати токен як змінну оточення у вашій сесії:

1. Отримайте персональний токен доступу на сторінці [GitHub Settings -> Developer Settings -> Personal Access Tokens](https://github.com/settings/tokens). Переконайтеся, що ви надали токену права `repo` для доступу до репозиторіїв і створення релізів.

2. Експортуйте токен у вашу сесію терміналу:

```bash
export GITHUB_TOKEN="your_personal_access_token"
```

Після цього команди `gh` автоматично використовуватимуть цей токен для аутентифікації.

---

### 4. Створіть новий реліз на GitHub

Тепер створіть новий реліз для Helm чарта KBOT, переконавшись, що номер версії (`1.0.12`) відповідає тому, що ви задали у файлі `values.yaml`:

```bash
gh release create v1.0.12 helm-1.0.12.tgz -t "kbot v1.0.12" -n "Оновлена версія kbot v1.0.12 з новими покращеннями"
```

> **Примітка:** Замість `v1.0.12` та `helm-1.0.12.tgz` підставте правильну версію, яку ви випускаєте.

Ось розбивка цієї команди:

- `v1.0.12` — Версія, яку ви публікуєте. **Переконайтеся, що вона відповідає версії у вашому `values.yaml`.**
- `helm-1.0.12.tgz` — Це шлях до файлу пакета Helm чарта, який ви створили раніше.
- `-t "kbot v1.0.12"` — Заголовок релізу.
- `-n "Оновлена версія kbot v1.0.12 з новими покращеннями"` — Опис релізу (ви можете змінити його відповідно до своїх потреб).

Ця команда створить новий реліз у GitHub та завантажить ваш Helm чарт як актив релізу.

---

### 5. Перевірка релізу

Після створення релізу підтвердіть, що він успішно створений, відвідавши сторінку релізів вашого репозиторію на GitHub. Переконайтеся, що файл чарта було завантажено, і все виглядає правильно.

---

### Додаткові примітки

- Замість версії `1.0.12` використовуйте ту, яку ви випускаєте. Вона повинна відображатися у вашому файлі `values.yaml`.
- Перевіряйте, що всі дані про версію у файлах Helm чарта (наприклад, у `Chart.yaml` і `values.yaml`) оновлені.
- Якщо ви автоматизуєте процес, перед виконанням команд можна задати змінну оточення `GITHUB_TOKEN` для аутентифікації, це корисно для CI/CD пайплайнів.
- Ви можете слідувати цій інструкції щоразу, коли випускаєте нову версію KBOT через Helm.
